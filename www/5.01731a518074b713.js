"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5],{5:(M,m,c)=>{c.r(m),c.d(m,{ChatgptOpenaiPageModule:()=>T});var d=c(177),h=c(9417),a=c(8974),p=c(904),l=c(467),e=c(4438),f=c(995),v=c(6432),b=c(9109);const _=["scrollArea"];function C(i,g){if(1&i&&(e.j41(0,"div",19),e.nrm(1,"div",20),e.k0s()),2&i){const t=e.XpG().$implicit;e.R7$(),e.Y8G("innerHtml",t.text,e.npT)}}function x(i,g){if(1&i&&(e.j41(0,"div",21),e.nrm(1,"div",20),e.k0s()),2&i){const t=e.XpG().$implicit;e.R7$(),e.Y8G("innerHtml",t.text,e.npT)}}function y(i,g){if(1&i&&(e.j41(0,"div",16),e.DNE(1,C,2,1,"div",17)(2,x,2,1,"div",18),e.k0s()),2&i){const t=g.$implicit;e.Y8G("ngClass",t.sender),e.R7$(),e.Y8G("ngIf","assistant"==t.sender),e.R7$(),e.Y8G("ngIf","user"==t.sender)}}function I(i,g){1&i&&e.nrm(0,"ion-spinner",22)}const P=[{path:"",component:(()=>{class i{constructor(t,n,s,r,o,u){this.redditService=t,this.loadingController=n,this.openaiService=s,this.localStore=r,this.route=o,this.router=u,this.userInput="",this.response="",this.aiResponse="",this.messages=["Quel est le type d assurance ?"],this.spinner=!1,this.fullText=""}ionViewWillEnter(){var t=this;return(0,l.A)(function*(){t.iduser=t.localStore.getItem("iduser"),t.thread_id=t.localStore.getItem("thread_id"),t.assistant_id=t.localStore.getItem("assistant_id"),(null==t.thread_id||null==t.assistant_id)&&t.CreateAssistant()})()}getdata(t){var n=this;return(0,l.A)(function*(){n.redditService.getByid("assistants",n.assistant_id).subscribe(s=>{console.log(s),n.posts=[s],n.title=n.posts[0].title,n.vector_id=n.posts[0].id_vector,n.assitant_id=n.posts[0].assitant_id,n.thread_id=n.posts[0].thread_id,n.category=n.posts[0].category,n.getHistorique(t)})})()}getHistorique(t){var n=this;return(0,l.A)(function*(){n.redditService.getMessagesBythread(n.thread_id).subscribe(s=>{t.dismiss(),console.log(s),n.historiques=s.messages.data.reverse(),console.log("----LOG CATEGORY-------"),console.log(n.historiques.length),console.log(n.category),n.historiques.forEach(function(){var r=(0,l.A)(function*(o){n.aiResponse=o.content[0].text.value.replace(/\*\*/g,""),n.messages.push({text:n.aiResponse,sender:o.role}),n.scrollToBottom()});return function(o){return r.apply(this,arguments)}}())})})()}scrollToTop(){this.content.scrollToBottom(500)}getSpinner(){var t=this;return(0,l.A)(function*(){t.spinner=!0})()}stopSpinner(){var t=this;return(0,l.A)(function*(){t.spinner=!1})()}update(t){var n=this;return(0,l.A)(function*(){var s={title:t};console.log(s),n.redditService.update("assistants",n.id,s).toPromise().then(function(){var r=(0,l.A)(function*(o){console.log(o)});return function(o){return r.apply(this,arguments)}}())})()}checkForSource(t){return/\u2020source\u3011./.test(t)}searchForAnySource(t){return/\[\d+:\d+\u2020source\]/.test(t)}scrollToBottom(){setTimeout(()=>{this.content.scrollToBottom(300)},100)}askAI(){var t=this;return(0,l.A)(function*(){console.log("-------- Send message -----------");const n=yield t.loadingController.create({});n.present();var s=JSON.stringify({content:t.userInput,thread_id:t.thread_id});console.log(s),t.update(t.userInput),t.redditService.addPost("addMessageToThread",s).subscribe(function(){var r=(0,l.A)(function*(o){console.log(o),setTimeout(()=>{t.runAI(),t.userInput="",n.dismiss()},200)});return function(o){return r.apply(this,arguments)}}())})()}runAI(){var t=this;return(0,l.A)(function*(){t.getSpinner(),t.aiResponse="",t.messages.push({text:t.userInput,sender:"user"}),yield t.openaiService.streamThreadSaveQuestionWithoutFile(t.thread_id,t.assistant_id,t.userInput,n=>{n=n.replace(/\*\*/g,""),console.log(n),t.aiResponse+=n,console.log(t.aiResponse),console.log("-----***source******----"),t.aiResponse.includes("\n")?(console.log("Il y a un retour \xe0 la ligne !"),t.messages.push({text:t.aiResponse,sender:"assistant"}),t.scrollToBottom(),t.aiResponse="",t.stopSpinner(),t.userInput=""):setTimeout(()=>{console.log("Il y a un retour \xe0 la ligne !"),t.messages.push({text:t.aiResponse,sender:"ai"}),t.aiResponse="",t.stopSpinner()},8e3)})})()}CreateAssistant(){var t=this;return(0,l.A)(function*(){var n=JSON.stringify({title:t.title,userid:t.iduser,category:"chat"});console.log(n);const s=yield t.loadingController.create({message:"Chargement en cours"});s.present(),t.redditService.addPost("assitant_create_withoutfile",n).subscribe(function(){var r=(0,l.A)(function*(o){setTimeout(()=>{console.log(o),console.log(o.assistant.id),t.thread_id=o.thread_id,t.assistant_id=o.assitantid,t.localStore.saveItem("thread_id",t.thread_id),t.localStore.saveItem("assistant_id",t.assistant_id),s.dismiss()},1e3)});return function(o){return r.apply(this,arguments)}}())})()}static{this.\u0275fac=function(n){return new(n||i)(e.rXU(f.s),e.rXU(a.Xi),e.rXU(v.Y),e.rXU(b.n),e.rXU(p.nX),e.rXU(p.Ix))}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["app-chatgpt-openai"]],viewQuery:function(n,s){if(1&n&&e.GBs(_,5),2&n){let r;e.mGM(r=e.lsd())&&(s.content=r.first)}},decls:22,vars:5,consts:[["scrollArea",""],["lines","none"],["slot","start"],["color","primary"],["slot","end",1,"fade-in","delay-1",3,"click"],["color","primary","name","add-circle-outline",2,"font-size","30px","right","0px"],["id","chat-content",2,"padding-bottom","200px","background-color","white","height","100%",3,"scrollEvents","fullscreen"],[2,"background-color","white !important","height","100%"],["sizeLg","12","sizeMd","12","sizeXs","12",2,"background-color","white !important","padding-bottom","200px"],[2,"background-color","white !important"],[3,"ngClass",4,"ngFor","ngForOf"],["name","bubbles",4,"ngIf"],["lines","none",1,"chat-input-item"],["placeholder","Votre question ici...",1,"chat-input",3,"ngModelChange","keyup.enter","ngModel"],["slot","end","color","secondary",3,"click"],["name","send"],[3,"ngClass"],["class","message-bubble ai",4,"ngIf"],["class","message-bubble user",4,"ngIf"],[1,"message-bubble","ai"],[3,"innerHtml"],[1,"message-bubble","user"],["name","bubbles"]],template:function(n,s){if(1&n){const r=e.RV6();e.j41(0,"ion-header")(1,"ion-toolbar",1)(2,"ion-buttons",2),e.nrm(3,"ion-menu-button",3),e.k0s(),e.j41(4,"ion-buttons",4),e.bIt("click",function(){return e.eBV(r),e.Njj(s.CreateAssistant())}),e.j41(5,"h4"),e.EFF(6," Cr\xe9er un nouvelle discussion "),e.k0s(),e.nrm(7,"ion-icon",5),e.k0s()()(),e.j41(8,"ion-content",6,0)(10,"ion-row",7)(11,"ion-col",8)(12,"div",9),e.DNE(13,y,3,3,"div",10)(14,I,1,0,"ion-spinner",11),e.k0s()()()(),e.j41(15,"ion-footer")(16,"ion-toolbar")(17,"ion-item",12)(18,"ion-input",13),e.mxI("ngModelChange",function(u){return e.eBV(r),e.DH7(s.userInput,u)||(s.userInput=u),e.Njj(u)}),e.bIt("keyup.enter",function(){return e.eBV(r),e.Njj(s.askAI())}),e.k0s(),e.j41(19,"ion-button",14),e.bIt("click",function(){return e.eBV(r),e.Njj(s.askAI())}),e.EFF(20," Envoyer "),e.nrm(21,"ion-icon",15),e.k0s()()()()}2&n&&(e.R7$(8),e.Y8G("scrollEvents",!0)("fullscreen",!0),e.R7$(5),e.Y8G("ngForOf",s.messages),e.R7$(),e.Y8G("ngIf",1==s.spinner),e.R7$(4),e.R50("ngModel",s.userInput))},dependencies:[d.YU,d.Sq,d.bT,h.BC,h.vS,a.Jm,a.QW,a.hU,a.W9,a.M0,a.eU,a.iq,a.$w,a.uz,a.MC,a.ln,a.w2,a.ai,a.Gw],styles:[".roundedInput[_ngcontent-%COMP%]{--border-color: gray;--border-radius: 5px;--border-width: 2px;--box-shadow: 2px gray;--highlight-height: 0;--background: #ffffff;padding:2%;height:50px}ion-boutton[_ngcontent-%COMP%]{text-transform:capitalize}.chat-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:10px}.user[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]{background-color:#d7d7d7;align-self:flex-end;border-radius:15px;padding:10px;margin:5px 0;max-width:70%;white-space:pre-line}.assistant[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%], .ai[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]{background-color:#fff;color:#000;align-self:flex-start;border-radius:15px;padding:10px;font-weight:700;line-height:1;margin:5px 0;max-width:70%;white-space:pre-line}ion-content[_ngcontent-%COMP%]{background-color:#fff!important}.chat-input-item[_ngcontent-%COMP%]{--background: #f1f1f1;--border-radius: 25px;padding:4px 10px;margin:8px;align-items:center;border:0pxx solid #ccc}.chat-input[_ngcontent-%COMP%]{--padding-start: 10px;--padding-end: 10px;font-size:16px;height:50px}"]})}}return i})()}];let O=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=e.$C({type:i})}static{this.\u0275inj=e.G2t({imports:[p.iI.forChild(P),p.iI]})}}return i})(),T=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=e.$C({type:i})}static{this.\u0275inj=e.G2t({imports:[d.MD,h.YN,a.bv,O]})}}return i})()}}]);