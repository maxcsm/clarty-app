"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2025],{2025:(_,p,c)=>{c.r(p),c.d(p,{FilePageModule:()=>A});var d=c(177),g=c(9417),o=c(8974),u=c(904),a=c(467),t=c(4438),m=c(995),f=c(6432),v=c(9109);const F=["scrollArea"];function y(s,h){if(1&s&&(t.j41(0,"ion-card")(1,"ion-card-header")(2,"ion-button",8),t.EFF(3),t.k0s(),t.EFF(4," Nom : "),t.j41(5,"b"),t.EFF(6),t.k0s(),t.nrm(7,"br"),t.EFF(8," Categorie : "),t.j41(9,"b"),t.EFF(10),t.k0s(),t.nrm(11,"br"),t.EFF(12," Date de d\xe9p\xf4t : "),t.j41(13,"b"),t.EFF(14),t.nI1(15,"date"),t.nI1(16,"date"),t.k0s(),t.nrm(17,"br"),t.k0s()()),2&s){const e=h.$implicit;t.R7$(3),t.JRh(e.category),t.R7$(3),t.SpI(" ",e.title," "),t.R7$(4),t.SpI(" ",e.category," "),t.R7$(4),t.Lme("",t.i5U(15,5,e.created_at,"dd-MM-yyyy")," \xe0 ",t.i5U(16,8,e.created_at,"HH:mm"),"")}}function I(s,h){if(1&s&&t.nrm(0,"img",11),2&s){const e=t.XpG().$implicit;t.FS9("src",e.image,t.B4B)}}function S(s,h){if(1&s&&(t.j41(0,"ion-card")(1,"ion-card-content"),t.nrm(2,"div",9),t.k0s(),t.DNE(3,I,1,1,"img",10),t.k0s()),2&s){const e=h.$implicit,i=t.XpG();t.R7$(2),t.Y8G("innerHtml",i.htmlFormattedText,t.npT),t.R7$(),t.Y8G("ngIf",e.image)}}const T=[{path:"",component:(()=>{class s{constructor(e,i,r,n,l,R){this.redditService=e,this.loadingController=i,this.openaiService=r,this.localStore=n,this.route=l,this.router=R,this.userInput="",this.response="",this.thread_id="",this.aiResponse="",this.messages=["Quel est le type d assurance ?"],this.spinner=!1,this.fullText=""}ngOnInit(){this.iduser=this.localStore.getItem("iduser"),this.route.params.subscribe(e=>{this.id=e.id,this.getdata()})}getdata(){var e=this;return(0,a.A)(function*(){e.redditService.getByid("files",e.id).subscribe(i=>{console.log(i),e.posts=[i],e.fileId=e.posts.id_file,e.id_vector=e.posts[0].id_vector,e.title=e.posts[0].title,e.htmlFormattedText=e.posts[0].content.replace(/\n/g,"<br>")})})()}ionViewWillEnter(){setTimeout(()=>{},200)}scrollToTop(){this.content.scrollToBottom(500)}getSpinner(){var e=this;return(0,a.A)(function*(){e.spinner=!0})()}stopSpinner(){var e=this;return(0,a.A)(function*(){e.spinner=!1})()}askAI(){var e=this;return(0,a.A)(function*(){e.getSpinner(),e.aiResponse="",e.messages.push({text:e.userInput,sender:"user"}),console.log("-----this.thread_id--------"),console.log(e.thread_id),console.log("-----this.assistantId--------"),console.log(e.assistantId),console.log("-----vectoretId--------"),console.log(e.vectorStoreId),yield e.openaiService.streamThreadResponse(e.thread_id,e.assistantId,e.vectorStoreId,e.userInput,i=>{i=i.replace(/\*\*/g,""),e.aiResponse+=i,console.log(e.aiResponse),console.log("-----***source******----"),e.aiResponse.includes("\n")&&(console.log("Il y a un retour \xe0 la ligne !"),e.messages.push({text:e.aiResponse,sender:"ai"}),e.aiResponse="",e.stopSpinner(),e.scrollToTop(),e.userInput="")})})()}checkForSource(e){return/\u2020source\u3011./.test(e)}searchForAnySource(e){return/\[\d+:\d+\u2020source\]/.test(e)}scrollToBottom(){setTimeout(()=>{this.content.scrollToBottom(300)},100)}assitant_create(e){var i=this;return(0,a.A)(function*(){var r=JSON.stringify({vector_store_id:i.vectorStoreId});console.log(r),i.redditService.addPost("assitant_create",r).subscribe(function(){var n=(0,a.A)(function*(l){console.log("ASSITANTCREATE --------------"),console.log(l["response "].id),i.assistantId=l["response "].id});return function(l){return n.apply(this,arguments)}}())})()}newThread(){var e=this;return(0,a.A)(function*(){var i=JSON.stringify({vectorStoreId:e.vectorStoreId});e.redditService.addPost("newthread_chatgpt",i).subscribe(function(){var r=(0,a.A)(function*(n){console.log(n.thread_id),e.thread_id=n.thread_id});return function(n){return r.apply(this,arguments)}}())})()}searchCategory(){var e=this;return(0,a.A)(function*(){var i=JSON.stringify({file_id:e.vectorStoreId});e.redditService.addPost("searchCategoryByFileId",i).subscribe(function(){var r=(0,a.A)(function*(n){console.log(n.thread_id),e.thread_id=n.thread_id});return function(n){return r.apply(this,arguments)}}())})()}askAIWithoutFile(){var e=this;return(0,a.A)(function*(){setTimeout(()=>{e.userInput=""},2e3),e.aiResponse="",yield e.openaiService.streamChatCompletion(e.userInput,i=>{e.aiResponse+=i})})()}CreateAssistantThreadByFile(){var e=this;return(0,a.A)(function*(){var i=JSON.stringify({vector_store_id:e.id_vector,title:e.title,userid:e.iduser,category:"fichier"});console.log(i);const r=yield e.loadingController.create({message:"Chargement en cours"});r.present(),e.redditService.addPost("CreateAssistantThreadByFile",i).subscribe(function(){var n=(0,a.A)(function*(l){console.log(l),setTimeout(()=>{console.log(l.assistant.id),r.dismiss(),e.router.navigateByUrl("/chat-doc/"+l.assistant.id)},1e3)});return function(l){return n.apply(this,arguments)}}())})()}static{this.\u0275fac=function(i){return new(i||s)(t.rXU(m.s),t.rXU(o.Xi),t.rXU(f.Y),t.rXU(v.n),t.rXU(u.nX),t.rXU(u.Ix))}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["app-file"]],viewQuery:function(i,r){if(1&i&&t.GBs(F,5),2&i){let n;t.mGM(n=t.lsd())&&(r.content=n.first)}},decls:16,vars:3,consts:[["lines","none"],["slot","start"],["color","primary"],[3,"fullscreen"],["sizeLg","6","sizeMd","6","sizeXs","12"],[4,"ngFor","ngForOf"],["icon-left","","size","primary","expand","full","shape","round",3,"click"],["name","chatbubbles-outline"],["expand","block","fill","outline"],[3,"innerHtml"],[3,"src",4,"ngIf"],[3,"src"]],template:function(i,r){1&i&&(t.j41(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),t.nrm(3,"ion-back-button",2),t.k0s(),t.j41(4,"ion-title")(5,"h4"),t.EFF(6,"D\xe9tails du fichier "),t.k0s()()()(),t.j41(7,"ion-content",3)(8,"ion-row")(9,"ion-col",4),t.DNE(10,y,18,11,"ion-card",5),t.j41(11,"ion-button",6),t.bIt("click",function(){return r.CreateAssistantThreadByFile()}),t.nrm(12,"ion-icon",7),t.EFF(13," Commencer une conversation "),t.k0s(),t.DNE(14,S,4,2,"ion-card",5),t.k0s(),t.nrm(15,"ion-col",4),t.k0s()()),2&i&&(t.R7$(7),t.Y8G("fullscreen",!0),t.R7$(3),t.Y8G("ngForOf",r.posts),t.R7$(4),t.Y8G("ngForOf",r.posts))},dependencies:[d.Sq,d.bT,o.Jm,o.QW,o.b_,o.I9,o.ME,o.hU,o.W9,o.eU,o.iq,o.ln,o.BC,o.ai,o.el,d.vh]})}}return s})()}];let b=(()=>{class s{static{this.\u0275fac=function(i){return new(i||s)}}static{this.\u0275mod=t.$C({type:s})}static{this.\u0275inj=t.G2t({imports:[u.iI.forChild(T),u.iI]})}}return s})(),A=(()=>{class s{static{this.\u0275fac=function(i){return new(i||s)}}static{this.\u0275mod=t.$C({type:s})}static{this.\u0275inj=t.G2t({imports:[d.MD,g.YN,o.bv,b]})}}return s})()}}]);