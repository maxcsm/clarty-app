"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5689],{5689:($,C,d)=>{d.r(C),d.d(C,{ComparerPageModule:()=>R});var f=d(177),g=d(9417),a=d(8974),_=d(904),c=d(467),h=d(1626),u=d(3114),e=d(4438),b=d(4517),S=d(995),P=d(6432),T=d(9109);const x=["scrollArea"],A=["fileInput"],O=["pageContent"];function I(s,p){if(1&s&&(e.j41(0,"ion-item",13),e.nrm(1,"ion-icon",14),e.j41(2,"ion-label")(3,"h2"),e.EFF(4),e.k0s(),e.j41(5,"p",15),e.EFF(6),e.k0s()(),e.j41(7,"ion-badge",16),e.EFF(8),e.k0s()()),2&s){const t=p.$implicit;e.R7$(4),e.JRh(t.name),e.R7$(2),e.JRh(t.category),e.R7$(2),e.JRh(t.prix_cotisation)}}function w(s,p){if(1&s&&(e.j41(0,"ion-card")(1,"ion-list"),e.DNE(2,I,9,3,"ion-item",12),e.k0s()()),2&s){const t=e.XpG();e.R7$(2),e.Y8G("ngForOf",t.offres)}}function U(s,p){if(1&s&&(e.j41(0,"ion-item")(1,"ion-label")(2,"h3"),e.EFF(3),e.k0s(),e.j41(4,"p",23),e.EFF(5),e.k0s(),e.j41(6,"p",23),e.EFF(7),e.nI1(8,"number"),e.k0s()()()),2&s){const t=p.$implicit;e.R7$(3),e.JRh(t.name||"Nom non disponible"),e.R7$(2),e.SpI("Prix : ",t.price+" \u20ac",""),e.R7$(2),e.SpI("Similarit\xe9 : ",e.i5U(8,3,100*t.similarity,"1.0-2")," %")}}function D(s,p){if(1&s&&(e.j41(0,"ion-accordion",19)(1,"ion-item",20)(2,"ion-label"),e.EFF(3),e.k0s()(),e.j41(4,"div",21)(5,"ion-list"),e.DNE(6,U,9,6,"ion-item",22),e.k0s()()()),2&s){const t=p.$implicit;e.Mz_("value","offer-",t.offer_index,""),e.R7$(3),e.Lme(" Offre ",t.offer_index+1," \u2014 ",t.offer_category," "),e.R7$(3),e.Y8G("ngForOf",t.top_matches)}}function M(s,p){if(1&s){const t=e.RV6();e.j41(0,"ion-card")(1,"ion-accordion-group"),e.DNE(2,D,7,5,"ion-accordion",17),e.k0s(),e.j41(3,"ion-button",18),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.comparer())}),e.EFF(4," Rechercher des offres "),e.k0s()()}if(2&s){const t=e.XpG();e.R7$(2),e.Y8G("ngForOf",t.comparaisonData)}}const E=[{path:"",component:(()=>{class s{constructor(t,o,i,r,l,n,y,v,F,m,j,X,z,G,N){this.navCtrl=t,this.formBuilder=o,this.popoverCtrl=i,this.alertController=r,this.menu=l,this.loadingController=n,this.redditService=y,this.router=v,this.toastCtrl=F,this.loadingCtrl=m,this.modalController=j,this.http=X,this.openaiService=z,this.localStore=G,this.actionSheetCtrl=N,this.table="locations",this.category="location",this.status="",this.filter="",this.wordid="",this.total=0,this.last_page=0,this.per_page=20,this.order_id="id",this.order_by="desc",this.title="",this.UrlImage="",this.typedText="",this.fullText="T\xe9l\xe9chargez votre devis &\n          obtenez des r\xe9ponses\n          instantan\xe9e.",this.typingSpeed=60,this.isShrunk=!1,this.segment="mesoffres",this.checkPermissions=(0,c.A)(function*(){if("denied"===(yield u.i7.checkPermissions()).camera){const V=yield u.i7.requestPermissions();console.log(V)}}),this.selectedFile=null,this.page=1}ngOnInit(){this.checkPermissions(),this.getMyOffre()}ionViewWillEnter(){this.vectorStoreId=this.localStore.getItem("vectorStoreId"),this.iduser=this.localStore.getItem("iduser"),console.log("Vector ID"),console.log(this.vectorStoreId),this.typeWriter(0)}ionViewDidEnter(){this.pageContent.scrollToTop(400),this.typedText="",this.typeWriter(0)}onScroll(t){this.isShrunk=t.detail.scrollTop>50}typeWriter(t){t<this.fullText.length&&(this.typedText+=this.fullText.charAt(t),setTimeout(()=>this.typeWriter(t+1),this.typingSpeed))}addFile(t){var o=this;return(0,c.A)(function*(){const i=yield o.loadingCtrl.create({cssClass:"ion-loading",spinner:"circular",message:"Traitement assitant AI"});i.present();var r=JSON.stringify({id_file:o.idfile,id_vector:o.NewVectorId,title:o.defaut_message,category:o.defaut_message,address:o.defaut_message,delay:o.defaut_message,company_name:o.defaut_message,content:o.defaut_message,price:o.defaut_message,edited_by:o.iduser,image:o.image});console.log(r),o.redditService.addPost("files",r).subscribe(function(){var l=(0,c.A)(function*(n){console.log(n),o.responsePDFSAVE=n,o.CreateAssistantThreadByFile(n.id_vector),o.search(o.responsePDFSAVE.id_file,o.responsePDFSAVE.id),setTimeout(()=>{i.dismiss()},1e3)});return function(n){return l.apply(this,arguments)}}())})()}search(t,o){var i=this;return(0,c.A)(function*(){var r=JSON.stringify({file_id:t,file_id_db:o});console.log(r),i.redditService.addPost("searchCategoryByFileId",r).subscribe(function(){var l=(0,c.A)(function*(n){console.log(n),setTimeout(()=>{},1e3)});return function(n){return l.apply(this,arguments)}}())})()}CreateAssistantThreadByFile(t){var o=this;return(0,c.A)(function*(){var i=JSON.stringify({vector_store_id:t,vector_allfiles_id:o.vectorStoreId,userid:o.iduser,category:"devis"});console.log(i);const r=yield o.loadingController.create({message:"Chargement en cours"});r.present(),o.redditService.addPost("CreateAssistantThreadByQuote",i).subscribe(function(){var l=(0,c.A)(function*(n){console.log(n),setTimeout(()=>{console.log(n.assistant.id),r.dismiss(),o.router.navigateByUrl("/chat-doc/"+n.assistant.id)},1e3)});return function(n){return l.apply(this,arguments)}}())})()}onFileSelected(t){const o=t.target;o?.files?.length&&(this.selectedFile=o.files[0],this.uploadFile())}uploadFile(){var t=this;return(0,c.A)(function*(){if(!t.selectedFile)return void alert("Please select a file first.");const o=yield t.loadingController.create({});o.present(),t.NewVectorId=yield t.openaiService.createVector_stores();const i=new FormData;i.append("file",t.selectedFile);const r=new h.Lr;t.http.post("https://www.api1.alpes-solutech.fr/api/public_assitant_uploadfile",i,{headers:r}).subscribe(function(){var l=(0,c.A)(function*(n){console.log("File uploaded successfully:",n),t.upladfile=[n],t.idfile=t.upladfile[0].id,console.log("File ID:",t.idfile),console.log(t.NewVectorId),console.log(t.vectorStoreId),t.addFile(t.idfile),t.reponseAttachement=t.openaiService.attachFileToVectorStore(t.NewVectorId,t.idfile),setTimeout(()=>{o.dismiss()},2e3)});return function(n){return l.apply(this,arguments)}}())})()}uploadFileUrl(t){var o=this;return(0,c.A)(function*(){const i=yield o.loadingController.create({});i.present(),o.NewVectorId=yield o.openaiService.createVector_stores();try{const r=yield fetch(t);if(console.log("File ID:",r),!r.ok)throw new Error(`HTTP error! Status: ${r.status}`);const l=yield r.blob(),n=new File([l],"document.pdf",{type:"application/pdf"});console.log(n);const y=new FormData;y.append("file",n);const v=new h.Lr;o.http.post("https://www.api1.alpes-solutech.fr/api/public_assitant_uploadfile",y,{headers:v}).subscribe(function(){var F=(0,c.A)(function*(m){console.log("File uploaded successfully:",m),o.upladfile=[m],o.idfile=o.upladfile[0].id,console.log("File ID:",o.idfile),o.addFile(o.idfile),o.reponseAttachement=o.openaiService.attachFileToVectorStore(o.NewVectorId,o.idfile),o.reponseAttachement=o.openaiService.attachFileToVectorStore(o.vectorStoreId,o.idfile)});return function(m){return F.apply(this,arguments)}}())}catch(r){console.error("Error uploading file:",r)}setTimeout(()=>{i.dismiss()},2e3)})()}addFormGallery(){var t=this;return(0,c.A)(function*(){const o=yield u.i7.getPhoto({resultType:u.LK.Base64,quality:2,source:u.ru.Photos});t.format=o.format,t.base64=o.base64String;var i=JSON.stringify({format:t.format,base64:t.base64});t.image="data:image/"+o.format+";base64,"+o.base64String,console.log(i),t.uploadOcr();const r=yield t.loadingCtrl.create({cssClass:"ion-loading",spinner:"circular",message:"Enregistrement de l'image"});r.present(),setTimeout(()=>{r.dismiss()},1e3)})()}addFormCamera(){var t=this;return(0,c.A)(function*(){const o=yield u.i7.getPhoto({resultType:u.LK.Base64,quality:2,source:u.ru.Camera});t.format=o.format,t.base64=o.base64String;var i=JSON.stringify({format:t.format,base64:t.base64});t.image="data:image/"+o.format+";base64,"+o.base64String,console.log(i),t.uploadOcr();const r=yield t.loadingCtrl.create({cssClass:"ion-loading",spinner:"circular",message:"Enregistrement de l'image"});r.present(),setTimeout(()=>{r.dismiss()},1e3)})()}uploadOcr(){var t=this;return(0,c.A)(function*(){console.log("------Upload OCR-------");const o=yield t.loadingCtrl.create({cssClass:"ion-loading",spinner:"circular",message:"Traitement OCR"});o.present();const i=new FormData;i.append("apikey","K86968436988957"),i.append("base64Image",t.image),i.append("language","fre"),i.append("isCreateSearchablePdf","true"),i.append("isSearchablePdfHideTextLayer","true"),console.log(i);const r=new h.Lr;t.http.post("https://api.ocr.space/parse/image",i,{headers:r}).subscribe(function(){var l=(0,c.A)(function*(n){console.log("File uploaded successfully:",[n]),t.doc=[n],console.log(t.doc),console.log(t.doc[0].SearchablePDFURL),t.url=t.doc[0].SearchablePDFURL,console.log(t.url),setTimeout(()=>{t.selectFileFromUrl(),o.dismiss()},1e3)});return function(n){return l.apply(this,arguments)}}())})()}selectFileFromUrl(){var t=this;this.defaut_message="Traitement en cours ...";var o=JSON.stringify({url:this.url});console.log(o),this.redditService.addPost("public_assitant_uploadFromUrlToCurl",o).subscribe(function(){var i=(0,c.A)(function*(r){console.log(r),console.log("File uploaded successfully:",r),t.upladfile=[r],t.idfile=t.upladfile[0].id,console.log("File ID:",t.idfile),t.addFile(t.idfile),t.reponseAttachement=t.openaiService.attachFileToVectorStore(t.vectorStoreId,t.idfile),setTimeout(()=>{t.image=""},1e3)});return function(r){return i.apply(this,arguments)}}())}nextFile(t,o){var i=this;return(0,c.A)(function*(){i.router.navigateByUrl("/file/"+o.id)})()}downloadAndUploadFile(t){this.http.get(t,{responseType:"blob"}).subscribe(o=>{console.log("Downloaded file:",o),this.uploadFileToOpenAi(o)},o=>console.error("Download error:",o))}uploadFileToOpenAi(t){const i=new FormData,r=new File([t],"document.pdf",{type:"application/pdf"});i.append("file",r),this.http.post("https://www.api1.alpes-solutech.fr/api/public_assitant_uploadfile",i).subscribe(n=>{console.log("Upload success:",n)},n=>{console.error("Upload failed:",n)})}catch(t){console.error("Error uploading file:",t)}presentUploadOptions(){var t=this;return(0,c.A)(function*(){yield(yield t.actionSheetCtrl.create({header:"Ajouter un fichier",cssClass:"custom-action-sheet-header",buttons:[{text:"Depuis les fichiers (PDF)",icon:"document",cssClass:"custom-action-sheet-button document",handler:()=>{t.fileInput.nativeElement.click()}},{text:"Annuler",icon:"close",cssClass:"custom-action-sheet-button document",role:"cancel"}]})).present()})()}comparer(){var t=this;return(0,c.A)(function*(){console.log("-------- Send message -----------");const o=yield t.loadingController.create({});o.present();var i=JSON.stringify({user_id:t.iduser});t.redditService.addPost("CompareOffre",i).subscribe(function(){var r=(0,c.A)(function*(l){console.log(l),t.comparaisonData=l,setTimeout(()=>{o.dismiss()},200)});return function(l){return r.apply(this,arguments)}}())})()}getMyOffre(){var t=this;return(0,c.A)(function*(){const o=yield t.loadingController.create({});o.present(),t.redditService.getDataBypageByUser(t.iduser,t.page,"list_offres",t.per_page,t.order_id,t.order_by,t.category,t.status,t.filter).subscribe(i=>{setTimeout(()=>{o.dismiss()},200),console.log(i),t.offres=i})})()}static{this.\u0275fac=function(o){return new(o||s)(e.rXU(b.q9),e.rXU(g.ok),e.rXU(a.IE),e.rXU(a.hG),e.rXU(a._t),e.rXU(a.Xi),e.rXU(S.s),e.rXU(_.Ix),e.rXU(a.K_),e.rXU(a.Xi),e.rXU(a.W3),e.rXU(h.Qq),e.rXU(P.Y),e.rXU(T.n),e.rXU(a.GD))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["app-comparer"]],viewQuery:function(o,i){if(1&o&&(e.GBs(x,5),e.GBs(A,5),e.GBs(O,5)),2&o){let r;e.mGM(r=e.lsd())&&(i.content=r.first),e.mGM(r=e.lsd())&&(i.fileInput=r.first),e.mGM(r=e.lsd())&&(i.modal=r.first)}},decls:23,vars:4,consts:[[1,"fade-in","delay-1",2,"padding","10px 0 0 10px","font-weight","bold","text-align","left"],[1,"fade-in","delay-2",2,"padding-left","10px","padding-right","10%","text-align","left"],[1,"ion-padding"],["sizeLg","3","sizeMd","3","sizeXs","0"],["sizeLg","6","sizeMd","6","sizeXs","12",2,"border","2px","border-width","2px","text-align","center"],["justify-content-center",""],["sizeLg","12","sizeMd","12","sizeXs","12"],[3,"ngModelChange","ngModel"],["value","mesoffres"],["value","offres"],[3,"ngSwitch"],[4,"ngSwitchCase"],["button","","lines","full","detail","false",4,"ngFor","ngForOf"],["button","","lines","full","detail","false"],["name","business-outline","slot","start"],[1,"category"],["slot","end","color","primary"],[3,"value",4,"ngFor","ngForOf"],["expand","block","color","primary","shape","round",1,"ion-margin-top",3,"click"],[3,"value"],["slot","header"],["slot","content"],[4,"ngFor","ngForOf"],[2,"color","black"]],template:function(o,i){1&o&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"h4",0)(3,"span"),e.EFF(4," Comparer et \xe9conomiser"),e.k0s()(),e.j41(5,"h6",1),e.EFF(6," Comparez mieux, payez moins "),e.k0s()()(),e.j41(7,"ion-content",2)(8,"ion-grid")(9,"ion-row"),e.nrm(10,"ion-col",3),e.j41(11,"ion-col",4)(12,"ion-row",5),e.nrm(13,"ion-col",6),e.k0s(),e.j41(14,"ion-segment",7),e.mxI("ngModelChange",function(l){return e.DH7(i.segment,l)||(i.segment=l),l}),e.j41(15,"ion-segment-button",8),e.EFF(16," Mes assurances "),e.k0s(),e.j41(17,"ion-segment-button",9),e.EFF(18," Comparer "),e.k0s()(),e.j41(19,"div",10),e.DNE(20,w,3,1,"ion-card",11)(21,M,5,1,"ion-card",11),e.k0s()(),e.nrm(22,"ion-col",3),e.k0s()()()),2&o&&(e.R7$(14),e.R50("ngModel",i.segment),e.R7$(5),e.Y8G("ngSwitch",i.segment),e.R7$(),e.Y8G("ngSwitchCase","mesoffres"),e.R7$(),e.Y8G("ngSwitchCase","offres"))},dependencies:[f.Sq,f.ux,f.e1,g.BC,g.vS,a.xk,a.YH,a.In,a.Jm,a.b_,a.hU,a.W9,a.lO,a.eU,a.iq,a.uz,a.he,a.nf,a.ln,a.Gp,a.eP,a.ai,a.Je,f.QX],styles:[".pictureRound[_ngcontent-%COMP%]{border-radius:15px}@keyframes _ngcontent-%COMP%_subtle-zoom{0%,to{transform:scale(1)}50%{transform:scale(1.05)}}.zoom-effect[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_subtle-zoom 3s ease-in-out infinite;transition:transform .3s ease}ion-item[_ngcontent-%COMP%]{--padding-start: 16px;--inner-padding-end: 16px;--min-height: 64px}ion-icon[_ngcontent-%COMP%]{font-size:24px;color:var(--ion-color-secondary)}ion-label[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1rem;font-weight:600}ion-label[_ngcontent-%COMP%]   .category[_ngcontent-%COMP%]{margin:2px 0 0;font-size:.85rem;color:var(--ion-color-medium)}ion-badge[_ngcontent-%COMP%]{font-size:.9rem;padding:0 8px}ion-segment[_ngcontent-%COMP%]{--background: #e0e0e0;--color: #555;--color-checked: #d32f2f;--indicator-color: #d32f2f}"]})}}return s})()}];let k=(()=>{class s{static{this.\u0275fac=function(o){return new(o||s)}}static{this.\u0275mod=e.$C({type:s})}static{this.\u0275inj=e.G2t({imports:[_.iI.forChild(E),_.iI]})}}return s})(),R=(()=>{class s{static{this.\u0275fac=function(o){return new(o||s)}}static{this.\u0275mod=e.$C({type:s})}static{this.\u0275inj=e.G2t({imports:[f.MD,g.YN,a.bv,k]})}}return s})()}}]);