"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1275],{1275:(z,v,d)=>{d.r(v),d.d(v,{FilesPageModule:()=>j});var h=d(177),b=d(9417),c=d(8974),y=d(904),l=d(467),_=d(1626),u=d(3114),i=d(4438),A=d(4517),S=d(995),C=d(6432),I=d(9109);const w=["fileInput"];function x(n,p){if(1&n&&i.nrm(0,"img",14),2&n){const t=i.XpG();i.FS9("src",t.image,i.B4B)}}function P(n,p){if(1&n&&i.nrm(0,"img",26),2&n){const t=i.XpG(2).$implicit;i.Y8G("src",t.image,i.B4B)}}function T(n,p){1&n&&i.nrm(0,"img",27)}function D(n,p){if(1&n){const t=i.RV6();i.j41(0,"ion-item",20),i.DNE(1,P,1,1,"img",21)(2,T,1,0,"img",22),i.j41(3,"ion-label",23),i.bIt("click",function(o){i.eBV(t);const s=i.XpG().$implicit,r=i.XpG(3);return i.Njj(r.nextFile(o,s))}),i.EFF(4," Cat\xe9gorie : "),i.j41(5,"b"),i.EFF(6),i.k0s(),i.nrm(7,"br"),i.EFF(8," Nom : "),i.j41(9,"b"),i.EFF(10),i.k0s(),i.nrm(11,"br"),i.EFF(12," Date de d\xe9p\xf4t : "),i.j41(13,"b"),i.EFF(14),i.nI1(15,"date"),i.k0s(),i.EFF(16," \xe0 "),i.j41(17,"b"),i.EFF(18),i.nI1(19,"date"),i.k0s(),i.nrm(20,"br"),i.k0s(),i.j41(21,"ion-button",24),i.bIt("click",function(o){i.eBV(t);const s=i.XpG().$implicit,r=i.XpG(3);return i.Njj(r.delete(o,s))}),i.nrm(22,"ion-icon",25),i.k0s()()}if(2&n){const t=i.XpG().$implicit;i.R7$(),i.Y8G("ngIf",t.image),i.R7$(),i.Y8G("ngIf",!t.image),i.R7$(4),i.JRh(t.category),i.R7$(4),i.JRh(t.title),i.R7$(4),i.JRh(i.i5U(15,6,t.created_at,"dd-MM-yyyy")),i.R7$(4),i.JRh(i.i5U(19,9,t.created_at,"HH:mm"))}}function E(n,p){if(1&n&&(i.qex(0),i.DNE(1,D,23,12,"ion-item",19),i.bVm()),2&n){const t=p.$implicit,e=i.XpG(2).$implicit;i.R7$(),i.Y8G("ngIf",t.category===e.name)}}function V(n,p){if(1&n&&(i.j41(0,"div"),i.DNE(1,E,2,1,"ng-container",13),i.k0s()),2&n){const t=i.XpG(2);i.R7$(),i.Y8G("ngForOf",t.posts)}}function U(n,p){if(1&n){const t=i.RV6();i.j41(0,"ion-list")(1,"ion-item",15),i.bIt("click",function(){const o=i.eBV(t).$implicit;return i.Njj(o.isOpen=!o.isOpen)}),i.nrm(2,"img",16),i.EFF(3),i.nrm(4,"ion-icon",17),i.k0s(),i.DNE(5,V,2,1,"div",18),i.k0s()}if(2&n){const t=p.$implicit,e=i.XpG();i.R7$(2),i.Y8G("src",t.icon,i.B4B),i.R7$(),i.Lme(" ",t.name," (",e.getFileCount(t.name),") "),i.R7$(),i.Y8G("name",t.isOpen?"chevron-up-outline":"chevron-down-outline"),i.R7$(),i.Y8G("ngIf",t.isOpen)}}const N=[{path:"",component:(()=>{class n{constructor(t,e,o,s,r,a,g,f,F,m,G,X,B,R,$){this.navCtrl=t,this.formBuilder=e,this.popoverCtrl=o,this.alertController=s,this.menu=r,this.loadingController=a,this.redditService=g,this.router=f,this.toastCtrl=F,this.loadingCtrl=m,this.modalController=G,this.http=X,this.openaiService=B,this.localStore=R,this.actionSheetCtrl=$,this.table="locations",this.category="location",this.status="",this.filter="",this.wordid="",this.total=0,this.last_page=0,this.per_page=50,this.order_id="id",this.order_by="desc",this.title="",this.UrlImage="",this.categories=[{name:"Assurance Auto / Moto",icon:"../assets/car.png",isOpen:!1},{name:"Assurance Habitation",icon:"../assets/house.png",isOpen:!1},{name:"Mutuelle Sant\xe9",icon:"../assets/medical.png",isOpen:!1},{name:"Assurance Emprunteur",icon:"../assets/money2.png",isOpen:!1},{name:"\xc9lectricit\xe9 / Gaz",icon:"../assets/electrical-energy.png",isOpen:!1}],this.checkPermissions=(0,l.A)(function*(){if("denied"===(yield u.i7.checkPermissions()).camera){const k=yield u.i7.requestPermissions();console.log(k)}}),this.selectedFile=null,this.page=1}ngOnInit(){this.checkPermissions()}ionViewWillEnter(){this.getData(),this.vectorStoreId=this.localStore.getItem("vectorStoreId"),this.iduser=this.localStore.getItem("iduser"),console.log("Vector ID"),console.log(this.vectorStoreId)}getData(){var t=this;return(0,l.A)(function*(){const e=yield t.loadingCtrl.create({message:"Chargement..",spinner:"bubbles"});t.redditService.getDataBypageByUser(t.iduser,t.page,"filesByUser",t.per_page,t.order_id,t.order_by,t.category,t.status,t.filter).subscribe(o=>{e.dismiss(),console.log(o),t.posts=o.data})})()}ngAfterViewInit(){const t=document.getElementById("page-header");t&&setTimeout(()=>{t.classList.add("visible")},300)}addFormGallery(){var t=this;return(0,l.A)(function*(){const e=yield u.i7.getPhoto({resultType:u.LK.Base64,quality:2,source:u.ru.Photos});t.format=e.format,t.base64=e.base64String;var o=JSON.stringify({format:t.format,base64:t.base64});t.image="data:image/"+e.format+";base64,"+e.base64String,console.log(o),t.uploadOcr();const s=yield t.loadingCtrl.create({cssClass:"ion-loading",spinner:"circular",message:"Enregistrement de l'image"});s.present(),setTimeout(()=>{s.dismiss()},1e3)})()}addFormCamera(){var t=this;return(0,l.A)(function*(){const e=yield u.i7.getPhoto({resultType:u.LK.Base64,quality:2,source:u.ru.Camera});t.format=e.format,t.base64=e.base64String;var o=JSON.stringify({format:t.format,base64:t.base64});t.image="data:image/"+e.format+";base64,"+e.base64String,console.log(o),t.uploadOcr();const s=yield t.loadingCtrl.create({cssClass:"ion-loading",spinner:"circular",message:"Enregistrement de l'image"});s.present(),setTimeout(()=>{s.dismiss()},1e3)})()}uploadOcr(){var t=this;return(0,l.A)(function*(){console.log("------Upload OCR-------");const e=yield t.loadingCtrl.create({cssClass:"ion-loading",spinner:"circular",message:"Traitement OCR"});e.present();const o=new FormData;o.append("apikey","K86968436988957"),o.append("base64Image",t.image),o.append("language","fre"),o.append("isCreateSearchablePdf","true"),o.append("isSearchablePdfHideTextLayer","true"),console.log(o);const s=new _.Lr;t.http.post("https://api.ocr.space/parse/image",o,{headers:s}).subscribe(function(){var r=(0,l.A)(function*(a){console.log("File uploaded successfully:",[a]),t.doc=[a],console.log(t.doc),console.log(t.doc[0].SearchablePDFURL),t.url=t.doc[0].SearchablePDFURL,console.log(t.url),setTimeout(()=>{t.selectFileFromUrl(),e.dismiss()},1e3)});return function(a){return r.apply(this,arguments)}}())})()}selectFileFromUrl(){var t=this;return(0,l.A)(function*(){t.defaut_message="Traitement en cours ...";var e=JSON.stringify({url:t.url});console.log(e),t.NewVectorId=yield t.openaiService.createVector_stores(),t.redditService.addPost("public_assitant_uploadFromUrlToCurl",e).subscribe(function(){var o=(0,l.A)(function*(s){console.log(s),console.log("File uploaded successfully:",s),t.upladfile=[s],t.idfile=t.upladfile[0].id,console.log("File ID:",t.idfile),t.reponseAttachement=t.openaiService.attachFileToVectorStore(t.NewVectorId,t.idfile),t.reponseAttachement=t.openaiService.attachFileToVectorStore(t.vectorStoreId,t.idfile),setTimeout(()=>{t.addFile(t.idfile),t.getData()},1e3)});return function(s){return o.apply(this,arguments)}}())})()}addFile(t){var e=this;return(0,l.A)(function*(){const o=yield e.loadingCtrl.create({cssClass:"ion-loading",spinner:"circular",message:"Traitement assitant AI"});o.present();var s=JSON.stringify({id_file:e.idfile,id_vector:e.NewVectorId,title:e.defaut_message,category:e.defaut_message,address:e.defaut_message,delay:e.defaut_message,company_name:e.defaut_message,content:e.defaut_message,price:e.defaut_message,edited_by:e.iduser,image:e.image});console.log(s),e.redditService.addPost("files",s).subscribe(function(){var r=(0,l.A)(function*(a){console.log(a),e.responsePDFSAVE=a,console.log("-----Search file ---------------"),console.log("-----this.responsePDFSAVE.id_file ---------------"),console.log(e.responsePDFSAVE.id_file),console.log("-----this.responsePDFSAVE.id ---------------"),console.log(e.responsePDFSAVE.id);const g=e.responsePDFSAVE.id_file,f=e.responsePDFSAVE.id;setTimeout(()=>{e.search(g,f)},1e3),setTimeout(()=>{o.dismiss(),e.image="",e.getData()},2e3)});return function(a){return r.apply(this,arguments)}}())})()}askdoc(){var t=this;return(0,l.A)(function*(){t.defaut_message="Traitement en cours ...";var e=JSON.stringify({file_id:"file-KFvE2nAuCUBMx5vX4BcA9P"});t.redditService.addPost("askdoc",e).subscribe(function(){var o=(0,l.A)(function*(s){console.log(s)});return function(s){return o.apply(this,arguments)}}())})()}findAuthorInFile(t,e){var o=this;return(0,l.A)(function*(){o.idfile=e.id_file,o.idfiledb=e.id;const s=yield o.openaiService.findAuthorInFile(o.idfile);console.log(s)})()}onFileSelected(t){const e=t.target;e?.files?.length&&(this.selectedFile=e.files[0],this.uploadFile())}uploadFile(){var t=this;return(0,l.A)(function*(){if(!t.selectedFile)return void alert("Please select a file first.");const e=yield t.loadingController.create({});e.present(),t.NewVectorId=yield t.openaiService.createVector_stores();const o=new FormData;o.append("file",t.selectedFile);const s=new _.Lr;t.http.post("https://www.api1.alpes-solutech.fr/api/public_assitant_uploadfile",o,{headers:s}).subscribe(function(){var r=(0,l.A)(function*(a){console.log("File uploaded successfully:",a),t.upladfile=[a],t.idfile=t.upladfile[0].id,console.log("File ID:",t.idfile),t.addFile(t.idfile),t.reponseAttachement=t.openaiService.attachFileToVectorStore(t.NewVectorId,t.idfile),t.reponseAttachement=t.openaiService.attachFileToVectorStore(t.vectorStoreId,t.idfile),setTimeout(()=>{t.getData(),e.dismiss()},2e3)});return function(a){return r.apply(this,arguments)}}())})()}uploadFileUrl(t){var e=this;return(0,l.A)(function*(){const o=yield e.loadingController.create({});o.present(),e.NewVectorId=yield e.openaiService.createVector_stores();try{const s=yield fetch(t);if(console.log("File ID:",s),!s.ok)throw new Error(`HTTP error! Status: ${s.status}`);const r=yield s.blob(),a=new File([r],"document.pdf",{type:"application/pdf"});console.log(a);const g=new FormData;g.append("file",a);const f=new _.Lr;e.http.post("https://www.api1.alpes-solutech.fr/api/public_assitant_uploadfile",g,{headers:f}).subscribe(function(){var F=(0,l.A)(function*(m){console.log("File uploaded successfully:",m),e.upladfile=[m],e.idfile=e.upladfile[0].id,console.log("File ID:",e.idfile),e.addFile(e.idfile),e.reponseAttachement=e.openaiService.attachFileToVectorStore(e.NewVectorId,e.idfile),e.reponseAttachement=e.openaiService.attachFileToVectorStore(e.vectorStoreId,e.idfile)});return function(m){return F.apply(this,arguments)}}())}catch(s){console.error("Error uploading file:",s)}setTimeout(()=>{e.getData(),o.dismiss()},2e3)})()}nextFile(t,e){var o=this;return(0,l.A)(function*(){o.router.navigateByUrl("/file/"+e.id)})()}search(t,e){var o=this;return(0,l.A)(function*(){console.log("------SEARCH------");var s=JSON.stringify({file_id:t,file_id_db:e});console.log(s),o.redditService.addPost("searchCategoryByFileId",s).subscribe(function(){var r=(0,l.A)(function*(a){console.log(a),setTimeout(()=>{o.getData(),o.CreateAssitant(e)},1e3)});return function(a){return r.apply(this,arguments)}}())})()}downloadAndUploadFile(t){this.http.get(t,{responseType:"blob"}).subscribe(e=>{console.log("Downloaded file:",e),this.uploadFileToOpenAi(e)},e=>console.error("Download error:",e))}uploadFileToOpenAi(t){const o=new FormData,s=new File([t],"document.pdf",{type:"application/pdf"});o.append("file",s),this.http.post("https://www.api1.alpes-solutech.fr/api/public_assitant_uploadfile",o).subscribe(a=>{console.log("Upload success:",a)},a=>{console.error("Upload failed:",a)})}catch(t){console.error("Error uploading file:",t)}CreateAssitant(t){var e=this;return(0,l.A)(function*(){var o=JSON.stringify({file_id_db:t,vector_store_id:e.NewVectorId});console.log(o),e.redditService.addPost("searchDataByFileId",o).subscribe(function(){var s=(0,l.A)(function*(r){console.log(r),e.newAssitant=r.assitantid,e.newthread_id=r.thread_id,console.log(e.reponseCatgorie),setTimeout(()=>{e.loadData(t)},200)});return function(r){return s.apply(this,arguments)}}())})()}loadData(t){var e=this;return(0,l.A)(function*(){e.reponseCatgorie="";const o=yield e.loadingCtrl.create({cssClass:"ion-loading",spinner:"circular",message:"Analyse en cours ..."});o.present(),console.log(e.newthread_id),console.log(e.newAssitant),console.log(e.NewVectorId),console.log(e.questionCategorie),e.questionCategorie="Quel est la categorie principale du document ? afficher uniquement la cat\xe9gorie sans phrase ",yield e.openaiService.streamThreadQuestion(e.newthread_id,e.newAssitant,e.NewVectorId,e.questionCategorie,s=>{s=s.replace(/\*\*/g,""),e.reponseCatgorie+=s}),setTimeout(()=>{e.reponseCatgorie=e.reponseCatgorie.replace("undefined",""),console.log("-----***source******----"),console.log(e.reponseCatgorie);var s={category:e.reponseCatgorie};console.log(s),e.redditService.update("files",t,s).toPromise().then(function(){var r=(0,l.A)(function*(a){console.log(a),e.getData(),o.dismiss(),e.CreateAssitantByCategory(t)});return function(a){return r.apply(this,arguments)}}())},900)})()}searchInfosdoc(t){var e=this;return(0,l.A)(function*(){e.reponseInfosdoc="";const o=yield e.loadingCtrl.create({cssClass:"ion-loading",spinner:"circular",message:"Analyse approfondie ..."});o.present(),console.log(e.newthread_id),console.log(e.newAssitant),console.log(e.NewVectorId),console.log(e.questionCategorie),e.questionCategorie="Repondre au questions sous forme de points.Afficher uniquement les questions et le reponses",yield e.openaiService.streamThreadQuestion(e.newthread_id,e.newAssitant,e.NewVectorId,e.questionCategorie,s=>{s=s.replace(/\*\*/g,""),e.reponseInfosdoc+=s}),setTimeout(()=>{e.reponseInfosdoc=e.reponseInfosdoc.replace("undefined",""),console.log("-----***source******----"),console.log(e.reponseCatgorie);var s={content:e.reponseInfosdoc};console.log(s),e.redditService.update("files",t,s).toPromise().then(function(){var r=(0,l.A)(function*(a){console.log(a),e.getData(),o.dismiss()});return function(a){return r.apply(this,arguments)}}())},900)})()}CreateAssitantByCategory(t){var e=this;return(0,l.A)(function*(){var o=JSON.stringify({file_id_db:t,vector_store_id:e.NewVectorId,category:e.reponseCatgorie});console.log(o),e.redditService.addPost("createAssitantByCategory",o).subscribe(function(){var s=(0,l.A)(function*(r){console.log(r),e.newAssitant=r.assitantid,e.newthread_id=r.thread_id,console.log(e.reponseCatgorie),setTimeout(()=>{e.searchInfosdoc(t)},200)});return function(r){return s.apply(this,arguments)}}())})()}delete(t,e){var o=this;return(0,l.A)(function*(){o.idfile=e.id_file,o.idfiledb=e.id;const s=yield o.loadingController.create({});s.present(),o.redditService.delete("files",o.idfiledb).toPromise().then(a=>{console.log(a)});const r=yield o.openaiService.deleteVectorStoreFile(o.vectorStoreId,o.idfile);console.log(r),setTimeout(()=>{o.getData(),s.dismiss()},2e3)})()}presentUploadOptions(){var t=this;return(0,l.A)(function*(){yield(yield t.actionSheetCtrl.create({header:"Ajouter un fichier",cssClass:"custom-action-sheet-header",buttons:[{text:"Depuis les fichiers (PDF)",icon:"document",cssClass:"custom-action-sheet-button document",handler:()=>{t.fileInput.nativeElement.click()}},{text:"Galerie",icon:"image",cssClass:"custom-action-sheet-button document",handler:()=>t.addFormGallery()},{text:"Cam\xe9ra",icon:"camera",cssClass:"custom-action-sheet-button document",handler:()=>t.addFormCamera()},{text:"Annuler",icon:"close",cssClass:"custom-action-sheet-button document",role:"cancel"}]})).present()})()}getFileCount(t){return this.posts&&Array.isArray(this.posts)?this.posts.filter(e=>e.category===t).length:0}static{this.\u0275fac=function(e){return new(e||n)(i.rXU(A.q9),i.rXU(b.ok),i.rXU(c.IE),i.rXU(c.hG),i.rXU(c._t),i.rXU(c.Xi),i.rXU(S.s),i.rXU(y.Ix),i.rXU(c.K_),i.rXU(c.Xi),i.rXU(c.W3),i.rXU(_.Qq),i.rXU(C.Y),i.rXU(I.n),i.rXU(c.GD))}}static{this.\u0275cmp=i.VBU({type:n,selectors:[["app-files"]],viewQuery:function(e,o){if(1&e&&i.GBs(w,5),2&e){let s;i.mGM(s=i.lsd())&&(o.fileInput=s.first)}},decls:22,vars:2,consts:[["fileInput",""],["id","page-header",1,"header-animate"],["lines","none"],[1,"fade-in","delay-1",2,"padding","10px 0 0 10px","font-weight","bold","text-align","left"],[1,"fade-in","delay-2",2,"padding-left","10px","padding-right","10%","text-align","left"],[1,"padding"],["sizeLg","3","sizeMd","3","sizeXs","0"],["sizeLg","6","sizeMd","6","sizeXs","12",2,"border","2px","border-width","2px","text-align","center"],["justify-content-center",""],["sizeLg","12","sizeMd","12","sizeXs","12"],["type","submit","icon-left","","size","secondary","expand","full","shape","round",2,"text-transform","none!important",3,"click"],["style","width:200px",3,"src",4,"ngIf"],["type","file","accept",".pdf",2,"display","none",3,"change"],[4,"ngFor","ngForOf"],[2,"width","200px",3,"src"],["button","","lines","none",1,"text-wrap","headerlist",3,"click"],[2,"width","50px","margin-right","15px",3,"src"],["slot","end",3,"name"],[4,"ngIf"],["class","text-wrap","lines","none","style","font-size: 10px;",4,"ngIf"],["lines","none",1,"text-wrap",2,"font-size","10px"],["style","height:50px;","slot","start",3,"src",4,"ngIf"],["src","../assets/icon/pdf.png","style","height:50px;","slot","start",4,"ngIf"],[3,"click"],["fill","outline","slot","end","size","small","color","light",3,"click"],["name","trash-outline"],["slot","start",2,"height","50px",3,"src"],["src","../assets/icon/pdf.png","slot","start",2,"height","50px"]],template:function(e,o){if(1&e){const s=i.RV6();i.j41(0,"ion-header",1)(1,"ion-toolbar",2)(2,"h4",3)(3,"span"),i.EFF(4,"T\xe9l\xe9chargez vos contrats et obtenez des r\xe9ponses instantan\xe9es"),i.k0s()(),i.j41(5,"h6",4),i.EFF(6,"Ajouter depuis la galerie ou la cam\xe9ra"),i.k0s()()(),i.j41(7,"ion-content")(8,"ion-grid")(9,"ion-row",5),i.nrm(10,"ion-col",6),i.j41(11,"ion-col",7)(12,"ion-row",8)(13,"ion-col",9),i.nrm(14,"ion-row"),i.j41(15,"ion-button",10),i.bIt("click",function(){return i.eBV(s),i.Njj(o.presentUploadOptions())}),i.EFF(16," Ajouter un document"),i.k0s(),i.DNE(17,x,1,1,"img",11),i.j41(18,"input",12,0),i.bIt("change",function(a){return i.eBV(s),i.Njj(o.onFileSelected(a))}),i.k0s()()(),i.DNE(20,U,6,5,"ion-list",13),i.k0s(),i.nrm(21,"ion-col",6),i.k0s()()()}2&e&&(i.R7$(17),i.Y8G("ngIf",o.image),i.R7$(3),i.Y8G("ngForOf",o.categories))},dependencies:[h.Sq,h.bT,c.Jm,c.hU,c.W9,c.lO,c.eU,c.iq,c.uz,c.he,c.nf,c.ln,c.ai,h.vh],styles:['@charset "UTF-8";.list-md[_ngcontent-%COMP%]{margin:0;padding:0;border-radius:15px;background:#fff}.headerlist[_ngcontent-%COMP%]{padding-top:5px;padding-bottom:5px;margin-top:40px;border-radius:15px;font-size:16px;font-weight:700;color:#1771f9;border:2px solid #1771f9}.header-animate[_ngcontent-%COMP%]{opacity:0;transform:translateY(-20px);transition:all .8s ease-out}.header-animate.visible[_ngcontent-%COMP%]{opacity:1;transform:translateY(0)}']})}}return n})()}];let O=(()=>{class n{static{this.\u0275fac=function(e){return new(e||n)}}static{this.\u0275mod=i.$C({type:n})}static{this.\u0275inj=i.G2t({imports:[y.iI.forChild(N),y.iI]})}}return n})(),j=(()=>{class n{static{this.\u0275fac=function(e){return new(e||n)}}static{this.\u0275mod=i.$C({type:n})}static{this.\u0275inj=i.G2t({imports:[h.MD,b.YN,c.bv,O]})}}return n})()}}]);