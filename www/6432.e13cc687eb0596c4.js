"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6432],{6432:(k,A,T)=>{T.d(A,{Y:()=>D});var c=T(467),S=T(4438),b=T(1626);let D=(()=>{class O{constructor(e){this.http=e,this.apiKeyData="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",this.baseUrl="https://api.openai.com/v2",this.fullText="",this.buffer="",this.count=1}streamChatCompletion(e,t){var o=this;return(0,c.A)(function*(){const r=(yield fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${o.apiKeyData}`,"Content-Type":"application/json"},body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"user",content:e}],stream:!0})})).body?.getReader(),s=new TextDecoder("utf-8");if(r)for(;;){const{done:l,value:m}=yield r.read();if(l)break;const h=s.decode(m,{stream:!0}).split("\n").filter(n=>""!==n.trim());for(const n of h)if(n.startsWith("data: ")){const i=n.replace("data: ","");if("[DONE]"===i)break;const d=JSON.parse(i).choices?.[0]?.delta?.content;d&&t(d)}}})()}streamChatCompletionAllChat(e,t){var o=this;return(0,c.A)(function*(){const a=yield fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${o.apiKeyData}`,"Content-Type":"application/json"},body:JSON.stringify({model:"gpt-3.5-turbo",messages:[{role:"user",content:e}],stream:!0})});console.log(a);const r=a.body?.getReader();console.log(r);const s=new TextDecoder("utf-8");if(r)for(;;){const{done:l,value:m}=yield r.read();if(l)break;const h=s.decode(m,{stream:!0}).split("\n").filter(n=>""!==n.trim());for(const n of h)if(console.log(n),n.startsWith("data: ")){const i=n.replace("data: ","");if("[DONE]"===i)break;const d=JSON.parse(i)?.delta?.content?.[0]?.text?.value;d&&t(d)}}})()}createThread(){var e=this;return(0,c.A)(function*(){return(yield(yield fetch(`${e.baseUrl}/threads`,{method:"POST",headers:{Authorization:`Bearer ${e.apiKeyData}`,"Content-Type":"application/json"}})).json()).id})()}sendMessageToThread(e,t){var o=this;return(0,c.A)(function*(){yield fetch(`${o.baseUrl}/threads/${e}/messages`,{method:"POST",headers:{Authorization:`Bearer ${o.apiKeyData}`,"Content-Type":"application/json"},body:JSON.stringify({role:"user",content:t})})})()}streamThreadResponse(e,t,o,a,r){var s=this;return(0,c.A)(function*(){const m=[o.replace("\n","")],u=yield fetch("https://api.openai.com/v1/threads/runs",{method:"POST",headers:{Authorization:`Bearer ${s.apiKeyData}`,"Content-Type":"application/json","OpenAI-Beta":"assistants=v2"},body:JSON.stringify({temperature:.11,top_p:1,model:"gpt-4o-mini",assistant_id:t,thread:{messages:[{role:"user",content:a}],tool_resources:{file_search:{vector_store_ids:m}}},tool_choice:{type:"file_search"},stream:!1})});console.log(u);const h=u.body?.getReader();console.log(h);const n=new TextDecoder("utf-8");if(h)for(;;){const{done:i,value:y}=yield h.read();if(i)break;const f=n.decode(y,{stream:!0}).split("\n").filter(p=>""!==p.trim());for(const p of f)if(console.log(p),p.startsWith("data: ")){const _=p.replace("data: ","");if("[DONE]"===_)break;const g=JSON.parse(_)?.delta?.content?.[0]?.text?.value;g&&r(g)}}})()}streamThreadQuestion(e,t,o,a,r){var s=this;return(0,c.A)(function*(){const m=[o.replace("\n","")],h=(yield fetch("https://api.openai.com/v1/threads/runs",{method:"POST",headers:{Authorization:`Bearer ${s.apiKeyData}`,"Content-Type":"application/json","OpenAI-Beta":"assistants=v2"},body:JSON.stringify({temperature:.11,top_p:1,model:"gpt-4o-mini",assistant_id:t,thread:{messages:[{role:"user",content:a}],tool_resources:{file_search:{vector_store_ids:m}}},tool_choice:{type:"file_search"},stream:!0})})).body?.getReader(),n=new TextDecoder("utf-8");let i="";for(;;){const{value:y,done:d}=yield h.read();if(d)break;i+=n.decode(y,{stream:!0});const f=i.split("\n");i=f.pop()||"";for(const p of f)if(p.startsWith("data: ")){const _=p.replace("data: ","").trim();if("[DONE]"===_){console.log("\u2705 Stream termin\xe9.");break}try{const v=JSON.parse(_);console.log("\u{1f4e6} Donn\xe9e pars\xe9e :",v);const g=v?.delta?.content?.[0]?.text?.value;g&&r(g)}catch{console.warn("\u26a0\ufe0f JSON invalide :",_)}}}})()}streamThreadSaveQuestion(e,t,o,a,r){var s=this;return(0,c.A)(function*(){o.replace("\n","");const u=yield fetch("https://api.openai.com/v1/threads/"+e+"/runs",{method:"POST",headers:{Authorization:`Bearer ${s.apiKeyData}`,"Content-Type":"application/json","OpenAI-Beta":"assistants=v2"},body:JSON.stringify({temperature:.11,top_p:1,model:"gpt-4o-mini",assistant_id:t,additional_messages:[{role:"user",content:a}],tool_choice:{type:"file_search"},stream:!0})});console.log(u);const h=u.body?.getReader(),n=new TextDecoder("utf-8");let i="";for(;;){const{value:y,done:d}=yield h.read();if(d)break;i+=n.decode(y,{stream:!0});const f=i.split("\n");i=f.pop()||"";for(const p of f)if(p.startsWith("data: ")){const _=p.replace("data: ","").trim();if("[DONE]"===_){console.log("\u2705 Stream termin\xe9.");break}try{const v=JSON.parse(_);console.log("\u{1f4e6} Donn\xe9e pars\xe9e :",v);const g=v?.delta?.content?.[0]?.text?.value;g&&r(g)}catch{console.warn("\u26a0\ufe0f JSON invalide :",_)}}}})()}streamThreadSaveQuestionWithoutFile(e,t,o,a){var r=this;return(0,c.A)(function*(){const s=yield fetch("https://api.openai.com/v1/threads/"+e+"/runs",{method:"POST",headers:{Authorization:`Bearer ${r.apiKeyData}`,"Content-Type":"application/json","OpenAI-Beta":"assistants=v2"},body:JSON.stringify({temperature:.11,top_p:1,model:"gpt-4o-mini",assistant_id:t,additional_messages:[{role:"user",content:o}],stream:!0})});console.log(s);const l=s.body?.getReader(),m=new TextDecoder("utf-8");let u="";for(;;){const{value:h,done:n}=yield l.read();if(n)break;u+=m.decode(h,{stream:!0});const i=u.split("\n");u=i.pop()||"";for(const y of i)if(y.startsWith("data: ")){const d=y.replace("data: ","").trim();if("[DONE]"===d){console.log("\u2705 Stream termin\xe9.");break}try{const f=JSON.parse(d);console.log("\u{1f4e6} Donn\xe9e pars\xe9e :",f);const p=f?.delta?.content?.[0]?.text?.value;p&&a(p)}catch{console.warn("\u26a0\ufe0f JSON invalide :",d)}}}})()}createVector_stores(){var e=this;return(0,c.A)(function*(){return(yield(yield fetch("https://api.openai.com/v1/vector_stores",{method:"POST",headers:{Authorization:`Bearer ${e.apiKeyData}`,"Content-Type":"application/json"}})).json()).id})()}updateVectorStoreFile(e,t){var o=this;return(0,c.A)(function*(){const r=yield(yield fetch("https://api.openai.com/v1/vector_stores/"+e+"/files/"+t,{method:"POST",headers:{Authorization:`Bearer ${o.apiKeyData}`,"Content-Type":"application/json"},body:JSON.stringify({attributes:{role:"user"}})})).json();return console.log(r),r.id})()}attachFileToVectorStore(e,t){var o=this;return(0,c.A)(function*(){const r=yield(yield fetch("https://api.openai.com/v1/vector_stores/"+e+"/file_batches",{method:"POST",headers:{Authorization:`Bearer ${o.apiKeyData}`,"Content-Type":"application/json"},body:JSON.stringify({file_ids:[t]})})).json();return console.log(r),r.id})()}listVectorStoreFiles(e){var t=this;return(0,c.A)(function*(){const o="https://api.openai.com/v1/vector_stores/"+e+"/files";try{const a=yield fetch(o,{method:"GET",headers:{Authorization:`Bearer ${t.apiKeyData}`}});if(!a.ok)throw new Error(`HTTP error! Status: ${a.status}`);const r=yield a.json();return console.log("Files in vector store:",r.data),r.data}catch(a){console.error("Error fetching vector store files:",a)}})()}deleteVectorStoreFile(e,t){var o=this;return(0,c.A)(function*(){const r="https://api.openai.com/v1/vector_stores/"+e+"/files/"+t;try{const s=yield fetch(r,{method:"DELETE",headers:{Authorization:`Bearer ${o.apiKeyData}`}});if(!s.ok)throw new Error(`Failed to delete file. Status: ${s.status}`);const l=yield s.json();return console.log("\u2705 File deleted:",l),l}catch(s){console.error("\u274c Error deleting file:",s)}})()}saveFileMetadata(e){return(0,c.A)(function*(){const t={fileId:e,username:"Example File",customName:"Example File",tags:["tag1","tag2"],description:"This file contains important data.",createdAt:(new Date).toISOString()};yield fetch("https://your-database-api.com/metadata",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),console.log("Custom metadata saved for file:",e)})()}getFileContent(e){var t=this;return(0,c.A)(function*(){const o=`https://api.openai.com/v1/files/${e}`;return(yield(yield fetch(o,{method:"GET",headers:{Authorization:`Bearer ${t.apiKeyData}`}})).json()).content})()}findAuthorInFile(e){var t=this;return(0,c.A)(function*(){console.log(e);const a=`Quel est le titre ?\n\n${yield t.getFileContent(e)}`;return yield(yield fetch("https://api.openai.com/v1/completions",{method:"POST",headers:{Authorization:`Bearer ${t.apiKeyData}`,"Content-Type":"application/json"},body:JSON.stringify({model:"gpt-4o-mini",prompt:a,max_tokens:100,temperature:.5})})).json()})()}fetchFile(e){return this.http.get(e,{responseType:"blob"})}uploadFileToOpenAI(e,t){const o=new FormData;return o.append("file",e,t),this.http.post("https://api.openai.com/v1/files",o,{headers:{Authorization:`Bearer ${this.apiKeyData}`}})}static{this.\u0275fac=function(t){return new(t||O)(S.KVO(b.Qq))}}static{this.\u0275prov=S.jDH({token:O,factory:O.\u0275fac,providedIn:"root"})}}return O})()}}]);