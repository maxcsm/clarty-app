"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2608],{2608:(j,y,c)=>{c.r(y),c.d(y,{DevisPageModule:()=>w});var b=c(177),F=c(9417),a=c(8974),g=c(904),n=c(467),f=c(1626),u=c(3114),i=c(4438),S=c(4517),C=c(995),T=c(6432),x=c(9109);const A=["scrollArea"],I=["fileInput"],P=["pageContent"],D=[{path:"",component:(()=>{class d{constructor(t,e,o,s,l,r,h,m,v,p,E,_,V,z,O){this.navCtrl=t,this.formBuilder=e,this.popoverCtrl=o,this.alertController=s,this.menu=l,this.loadingController=r,this.redditService=h,this.router=m,this.toastCtrl=v,this.loadingCtrl=p,this.modalController=E,this.http=_,this.openaiService=V,this.localStore=z,this.actionSheetCtrl=O,this.table="locations",this.category="location",this.status="",this.filter="",this.wordid="",this.total=0,this.last_page=0,this.per_page=20,this.order_id="id",this.order_by="desc",this.title="",this.UrlImage="",this.typedText="",this.fullText="T\xe9l\xe9chargez votre devis &\n          obtenez des r\xe9ponses\n          instantan\xe9e.",this.typingSpeed=60,this.isShrunk=!1,this.checkPermissions=(0,n.A)(function*(){if("denied"===(yield u.i7.checkPermissions()).camera){const X=yield u.i7.requestPermissions();console.log(X)}}),this.selectedFile=null,this.page=1}ngOnInit(){this.checkPermissions()}ionViewWillEnter(){this.vectorStoreId=this.localStore.getItem("vectorStoreId"),this.iduser=this.localStore.getItem("iduser"),console.log("Vector ID"),console.log(this.vectorStoreId),this.typeWriter(0)}ionViewDidEnter(){this.pageContent.scrollToTop(400),this.typedText="",this.typeWriter(0)}onScroll(t){this.isShrunk=t.detail.scrollTop>50}typeWriter(t){t<this.fullText.length&&(this.typedText+=this.fullText.charAt(t),setTimeout(()=>this.typeWriter(t+1),this.typingSpeed))}addFile(t){var e=this;return(0,n.A)(function*(){const o=yield e.loadingCtrl.create({cssClass:"ion-loading",spinner:"circular",message:"Traitement assitant AI"});o.present();var s=JSON.stringify({id_file:e.idfile,id_vector:e.NewVectorId,title:e.defaut_message,category:e.defaut_message,address:e.defaut_message,delay:e.defaut_message,company_name:e.defaut_message,content:e.defaut_message,price:e.defaut_message,edited_by:e.iduser,image:e.image});console.log(s),e.redditService.addPost("files",s).subscribe(function(){var l=(0,n.A)(function*(r){console.log(r),e.responsePDFSAVE=r,e.CreateAssistantThreadByFile(r.id_vector),e.search(e.responsePDFSAVE.id_file,e.responsePDFSAVE.id),setTimeout(()=>{o.dismiss()},1e3)});return function(r){return l.apply(this,arguments)}}())})()}search(t,e){var o=this;return(0,n.A)(function*(){var s=JSON.stringify({file_id:t,file_id_db:e});console.log(s),o.redditService.addPost("searchCategoryByFileId",s).subscribe(function(){var l=(0,n.A)(function*(r){console.log(r),setTimeout(()=>{},1e3)});return function(r){return l.apply(this,arguments)}}())})()}CreateAssistantThreadByFile(t){var e=this;return(0,n.A)(function*(){var o=JSON.stringify({vector_store_id:t,vector_allfiles_id:e.vectorStoreId,userid:e.iduser,category:"devis"});console.log(o);const s=yield e.loadingController.create({message:"Chargement en cours"});s.present(),e.redditService.addPost("CreateAssistantThreadByQuote",o).subscribe(function(){var l=(0,n.A)(function*(r){console.log(r),setTimeout(()=>{console.log(r.assistant.id),s.dismiss(),e.router.navigateByUrl("/chat-doc/"+r.assistant.id)},1e3)});return function(r){return l.apply(this,arguments)}}())})()}onFileSelected(t){const e=t.target;e?.files?.length&&(this.selectedFile=e.files[0],this.uploadFile())}uploadFile(){var t=this;return(0,n.A)(function*(){if(!t.selectedFile)return void alert("Please select a file first.");const e=yield t.loadingController.create({});e.present(),t.NewVectorId=yield t.openaiService.createVector_stores();const o=new FormData;o.append("file",t.selectedFile);const s=new f.Lr;t.http.post("https://www.api1.alpes-solutech.fr/api/public_assitant_uploadfile",o,{headers:s}).subscribe(function(){var l=(0,n.A)(function*(r){console.log("File uploaded successfully:",r),t.upladfile=[r],t.idfile=t.upladfile[0].id,console.log("File ID:",t.idfile),console.log(t.NewVectorId),console.log(t.vectorStoreId),t.addFile(t.idfile),t.reponseAttachement=t.openaiService.attachFileToVectorStore(t.NewVectorId,t.idfile),setTimeout(()=>{e.dismiss()},2e3)});return function(r){return l.apply(this,arguments)}}())})()}uploadFileUrl(t){var e=this;return(0,n.A)(function*(){const o=yield e.loadingController.create({});o.present(),e.NewVectorId=yield e.openaiService.createVector_stores();try{const s=yield fetch(t);if(console.log("File ID:",s),!s.ok)throw new Error(`HTTP error! Status: ${s.status}`);const l=yield s.blob(),r=new File([l],"document.pdf",{type:"application/pdf"});console.log(r);const h=new FormData;h.append("file",r);const m=new f.Lr;e.http.post("https://www.api1.alpes-solutech.fr/api/public_assitant_uploadfile",h,{headers:m}).subscribe(function(){var v=(0,n.A)(function*(p){console.log("File uploaded successfully:",p),e.upladfile=[p],e.idfile=e.upladfile[0].id,console.log("File ID:",e.idfile),e.addFile(e.idfile),e.reponseAttachement=e.openaiService.attachFileToVectorStore(e.NewVectorId,e.idfile),e.reponseAttachement=e.openaiService.attachFileToVectorStore(e.vectorStoreId,e.idfile)});return function(p){return v.apply(this,arguments)}}())}catch(s){console.error("Error uploading file:",s)}setTimeout(()=>{o.dismiss()},2e3)})()}addFormGallery(){var t=this;return(0,n.A)(function*(){const e=yield u.i7.getPhoto({resultType:u.LK.Base64,quality:2,source:u.ru.Photos});t.format=e.format,t.base64=e.base64String;var o=JSON.stringify({format:t.format,base64:t.base64});t.image="data:image/"+e.format+";base64,"+e.base64String,console.log(o),t.uploadOcr();const s=yield t.loadingCtrl.create({cssClass:"ion-loading",spinner:"circular",message:"Enregistrement de l'image"});s.present(),setTimeout(()=>{s.dismiss()},1e3)})()}addFormCamera(){var t=this;return(0,n.A)(function*(){const e=yield u.i7.getPhoto({resultType:u.LK.Base64,quality:2,source:u.ru.Camera});t.format=e.format,t.base64=e.base64String;var o=JSON.stringify({format:t.format,base64:t.base64});t.image="data:image/"+e.format+";base64,"+e.base64String,console.log(o),t.uploadOcr();const s=yield t.loadingCtrl.create({cssClass:"ion-loading",spinner:"circular",message:"Enregistrement de l'image"});s.present(),setTimeout(()=>{s.dismiss()},1e3)})()}uploadOcr(){var t=this;return(0,n.A)(function*(){console.log("------Upload OCR-------");const e=yield t.loadingCtrl.create({cssClass:"ion-loading",spinner:"circular",message:"Traitement OCR"});e.present();const o=new FormData;o.append("apikey","K86968436988957"),o.append("base64Image",t.image),o.append("language","fre"),o.append("isCreateSearchablePdf","true"),o.append("isSearchablePdfHideTextLayer","true"),console.log(o);const s=new f.Lr;t.http.post("https://api.ocr.space/parse/image",o,{headers:s}).subscribe(function(){var l=(0,n.A)(function*(r){console.log("File uploaded successfully:",[r]),t.doc=[r],console.log(t.doc),console.log(t.doc[0].SearchablePDFURL),t.url=t.doc[0].SearchablePDFURL,console.log(t.url),setTimeout(()=>{t.selectFileFromUrl(),e.dismiss()},1e3)});return function(r){return l.apply(this,arguments)}}())})()}selectFileFromUrl(){var t=this;this.defaut_message="Traitement en cours ...";var e=JSON.stringify({url:this.url});console.log(e),this.redditService.addPost("public_assitant_uploadFromUrlToCurl",e).subscribe(function(){var o=(0,n.A)(function*(s){console.log(s),console.log("File uploaded successfully:",s),t.upladfile=[s],t.idfile=t.upladfile[0].id,console.log("File ID:",t.idfile),t.addFile(t.idfile),t.reponseAttachement=t.openaiService.attachFileToVectorStore(t.vectorStoreId,t.idfile),setTimeout(()=>{t.image=""},1e3)});return function(s){return o.apply(this,arguments)}}())}nextFile(t,e){var o=this;return(0,n.A)(function*(){o.router.navigateByUrl("/file/"+e.id)})()}downloadAndUploadFile(t){this.http.get(t,{responseType:"blob"}).subscribe(e=>{console.log("Downloaded file:",e),this.uploadFileToOpenAi(e)},e=>console.error("Download error:",e))}uploadFileToOpenAi(t){const o=new FormData,s=new File([t],"document.pdf",{type:"application/pdf"});o.append("file",s),this.http.post("https://www.api1.alpes-solutech.fr/api/public_assitant_uploadfile",o).subscribe(r=>{console.log("Upload success:",r)},r=>{console.error("Upload failed:",r)})}catch(t){console.error("Error uploading file:",t)}presentUploadOptions(){var t=this;return(0,n.A)(function*(){yield(yield t.actionSheetCtrl.create({header:"Ajouter un fichier",cssClass:"custom-action-sheet-header",buttons:[{text:"Depuis les fichiers (PDF)",icon:"document",cssClass:"custom-action-sheet-button document",handler:()=>{t.fileInput.nativeElement.click()}},{text:"Annuler",icon:"close",cssClass:"custom-action-sheet-button document",role:"cancel"}]})).present()})()}static{this.\u0275fac=function(e){return new(e||d)(i.rXU(S.q9),i.rXU(F.ok),i.rXU(a.IE),i.rXU(a.hG),i.rXU(a._t),i.rXU(a.Xi),i.rXU(C.s),i.rXU(g.Ix),i.rXU(a.K_),i.rXU(a.Xi),i.rXU(a.W3),i.rXU(f.Qq),i.rXU(T.Y),i.rXU(x.n),i.rXU(a.GD))}}static{this.\u0275cmp=i.VBU({type:d,selectors:[["app-devis"]],viewQuery:function(e,o){if(1&e&&(i.GBs(A,5),i.GBs(I,5),i.GBs(P,5)),2&e){let s;i.mGM(s=i.lsd())&&(o.content=s.first),i.mGM(s=i.lsd())&&(o.fileInput=s.first),i.mGM(s=i.lsd())&&(o.modal=s.first)}},decls:33,vars:0,consts:[["fileInput",""],[1,"fade-in","delay-1",2,"padding","10px 0 0 10px","font-weight","bold","text-align","left"],[1,"fade-in","delay-2",2,"padding-left","10px","padding-right","10%","text-align","left"],[1,"ion-padding"],["sizeLg","3","sizeMd","3","sizeXs","0"],["sizeLg","6","sizeMd","6","sizeXs","12",2,"border","2px","border-width","2px","text-align","center"],["lines","none",1,"fade-in","delay-3",2,"background","#ffffff","border-radius","30px","padding","30px 20px","text-align","left","margin","5px 0px 0px 0px"],[2,"margin","0"],["src","assets/women5.png",1,"pictureRound","zoom-effect"],["lines","none",1,"fade-in","delay-4",2,"background","#ffffff","border-radius","30px","padding","30px 20px","text-align","left","margin","5px 0px 0px 0px"],["justify-content-center",""],["sizeLg","12","sizeMd","12","sizeXs","12"],["expand","block","icon-left","","size","primary","expand","full","shape","round",2,"text-transform","none!important",3,"click"],["type","file","accept","application/pdf","hidden","",3,"change"]],template:function(e,o){if(1&e){const s=i.RV6();i.j41(0,"ion-header")(1,"ion-toolbar")(2,"h4",1)(3,"span"),i.EFF(4," Lire et analyser ses devis "),i.k0s()(),i.j41(5,"h6",2),i.EFF(6," T\xe9l\xe9chargez votre devis, l\u2019IA vous dit tout "),i.k0s()()(),i.j41(7,"ion-content",3)(8,"ion-grid")(9,"ion-row"),i.nrm(10,"ion-col",4),i.j41(11,"ion-col",5)(12,"ion-item",6)(13,"h5",7),i.EFF(14," T\xe9l\xe9chargez votre devis & obtenez des r\xe9ponses instantan\xe9e "),i.k0s()(),i.nrm(15,"img",8),i.j41(16,"ion-item",9)(17,"h5",7),i.EFF(18," Importez un devis, Clarty analyse les montants, identifie les garanties et le reste \xe0 charge r\xe9el."),i.nrm(19,"br"),i.EFF(20," Vous voyez en un clin d\u2019\u0153il si c\u2019est avantageux\u2026 ou non. "),i.k0s()(),i.j41(21,"ion-row",10)(22,"ion-col",11)(23,"ion-row")(24,"ion-col",11)(25,"ion-button",12),i.bIt("click",function(){i.eBV(s);const r=i.sdS(28);return i.Njj(r.click())}),i.EFF(26," Ajouter un fichier devis "),i.k0s(),i.j41(27,"input",13,0),i.bIt("change",function(r){return i.eBV(s),i.Njj(o.onFileSelected(r))}),i.k0s()()()(),i.j41(29,"ion-item",9)(30,"h5",7),i.EFF(31," L\u2019IA compare m\xeame votre devis \xe0 votre contrat actuel pour vous alerter en cas d\u2019incoh\xe9rence. "),i.k0s()()()(),i.nrm(32,"ion-col",4),i.k0s()()()}},dependencies:[a.Jm,a.hU,a.W9,a.lO,a.eU,a.uz,a.ln,a.ai],styles:[".pictureRound[_ngcontent-%COMP%]{border-radius:15px}@keyframes _ngcontent-%COMP%_subtle-zoom{0%,to{transform:scale(1)}50%{transform:scale(1.05)}}.zoom-effect[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_subtle-zoom 3s ease-in-out infinite;transition:transform .3s ease}"]})}}return d})()}];let U=(()=>{class d{static{this.\u0275fac=function(e){return new(e||d)}}static{this.\u0275mod=i.$C({type:d})}static{this.\u0275inj=i.G2t({imports:[g.iI.forChild(D),g.iI]})}}return d})(),w=(()=>{class d{static{this.\u0275fac=function(e){return new(e||d)}}static{this.\u0275mod=i.$C({type:d})}static{this.\u0275inj=i.G2t({imports:[b.MD,F.YN,a.bv,U]})}}return d})()}}]);