"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5269],{5269:(M,h,a)=>{a.r(h),a.d(h,{ChatgptPageModule:()=>x});var d=a(177),u=a(9417),i=a(8974),p=a(904),c=a(467),t=a(4438),m=a(995),v=a(6432),I=a(9109);const b=["scrollArea"];function C(o,f){if(1&o&&(t.j41(0,"div",15)(1,"div",16),t.nrm(2,"div",17),t.k0s()()),2&o){const e=f.$implicit;t.Y8G("ngClass",e.sender),t.R7$(2),t.Y8G("innerHtml",e.text,t.npT)}}function y(o,f){1&o&&t.nrm(0,"ion-spinner",18)}const S=[{path:"",component:(()=>{class o{constructor(e,n,s,r){this.redditService=e,this.loadingController=n,this.openaiService=s,this.localStore=r,this.userInput="",this.response="",this.thread_id="",this.aiResponse="",this.messages=["Quel est le type d assurance ?"],this.spinner=!1,this.fullText=""}ionViewWillEnter(){this.vectorStoreId=this.localStore.getItem("vectorStoreId"),setTimeout(()=>{this.newThread();let e=this.assitant_create(this.vectorStoreId);console.log("-------ASSIATNT ID -----------"),console.log(e)},200)}scrollToTop(){this.content.scrollToBottom(500)}getSpinner(){var e=this;return(0,c.A)(function*(){e.spinner=!0})()}stopSpinner(){var e=this;return(0,c.A)(function*(){e.spinner=!1})()}askAI(){var e=this;return(0,c.A)(function*(){e.getSpinner(),e.aiResponse="",e.messages.push({text:e.userInput,sender:"user"}),e.assistantId="asst_lTTlvk1t0nswVedgMa6OaQ1L",console.log("-----this.thread_id--------"),console.log(e.thread_id),console.log("-----this.assistantId--------"),console.log(e.assistantId),console.log("-----vectoretId--------"),console.log(e.vectorStoreId),yield e.openaiService.streamThreadResponse(e.thread_id,e.assistantId,e.vectorStoreId,e.userInput,n=>{n=n.replace(/\*\*/g,""),e.aiResponse+=n,console.log(e.aiResponse),console.log("-----***source******----"),e.aiResponse.includes("\n")?(console.log("Il y a un retour \xe0 la ligne !"),e.messages.push({text:e.aiResponse,sender:"ai"}),e.aiResponse="",e.stopSpinner(),e.scrollToTop(),e.userInput=""):setTimeout(()=>{console.log("Il y a un retour \xe0 la ligne !"),e.messages.push({text:e.aiResponse,sender:"ai"}),e.aiResponse="",e.stopSpinner()},8e3)})})()}checkForSource(e){return/\u2020source\u3011./.test(e)}searchForAnySource(e){return/\[\d+:\d+\u2020source\]/.test(e)}scrollToBottom(){setTimeout(()=>{this.content.scrollToBottom(300)},100)}assitant_create(e){var n=this;return(0,c.A)(function*(){var s=JSON.stringify({vector_store_id:n.vectorStoreId});console.log(s),n.redditService.addPost("assitant_create",s).subscribe(function(){var r=(0,c.A)(function*(l){console.log("ASSITANTCREATE --------------"),console.log(l),console.log(l["response "].id),n.assistantId=l["response "].id});return function(l){return r.apply(this,arguments)}}())})()}newThread(){var e=this;return(0,c.A)(function*(){var n=JSON.stringify({vectorStoreId:e.vectorStoreId});e.redditService.addPost("newthread_chatgpt",n).subscribe(function(){var s=(0,c.A)(function*(r){console.log(r.thread_id),e.thread_id=r.thread_id});return function(r){return s.apply(this,arguments)}}())})()}searchCategory(){var e=this;return(0,c.A)(function*(){var n=JSON.stringify({file_id:e.vectorStoreId});e.redditService.addPost("searchCategoryByFileId",n).subscribe(function(){var s=(0,c.A)(function*(r){console.log(r.thread_id),e.thread_id=r.thread_id});return function(r){return s.apply(this,arguments)}}())})()}static{this.\u0275fac=function(n){return new(n||o)(t.rXU(m.s),t.rXU(i.Xi),t.rXU(v.Y),t.rXU(I.n))}}static{this.\u0275cmp=t.VBU({type:o,selectors:[["app-chatgpt"]],viewQuery:function(n,s){if(1&n&&t.GBs(b,5),2&n){let r;t.mGM(r=t.lsd())&&(s.content=r.first)}},decls:22,vars:5,consts:[["scrollArea",""],["color","primary"],["slot","start"],["id","chat-content",2,"background-color","white","height","100%",3,"scrollEvents","fullscreen"],[2,"background-color","white !important","height","100%"],["sizeLg","3","sizeMd","3","sizeXs","12",2,"background-color","white !important"],["sizeLg","6","sizeMd","6","sizeXs","12",2,"background-color","white !important","padding-bottom","200px"],[2,"background-color","white !important"],[3,"ngClass",4,"ngFor","ngForOf"],["name","bubbles",4,"ngIf"],["sizeLg","3","sizeMd","","sizeXs","12",2,"background-color","white !important"],["lines","none"],["placeholder","Votre question ici...",3,"ngModelChange","keyup.enter","ngModel"],["slot","end","color","secondary",3,"click"],["name","send"],[3,"ngClass"],[1,"message-bubble"],[3,"innerHtml"],["name","bubbles"]],template:function(n,s){if(1&n){const r=t.RV6();t.j41(0,"ion-header")(1,"ion-toolbar",1)(2,"ion-buttons",2),t.nrm(3,"ion-menu-button"),t.k0s(),t.j41(4,"ion-title"),t.EFF(5,"Clarty"),t.k0s()()(),t.j41(6,"ion-content",3,0)(8,"ion-row",4),t.nrm(9,"ion-col",5),t.j41(10,"ion-col",6)(11,"div",7),t.DNE(12,C,3,2,"div",8)(13,y,1,0,"ion-spinner",9),t.k0s()(),t.nrm(14,"ion-col",10),t.k0s()(),t.j41(15,"ion-footer")(16,"ion-toolbar")(17,"ion-item",11)(18,"ion-input",12),t.mxI("ngModelChange",function(g){return t.eBV(r),t.DH7(s.userInput,g)||(s.userInput=g),t.Njj(g)}),t.bIt("keyup.enter",function(){return t.eBV(r),t.Njj(s.askAI())}),t.k0s(),t.j41(19,"ion-button",13),t.bIt("click",function(){return t.eBV(r),t.Njj(s.askAI())}),t.EFF(20,"Envoyer "),t.nrm(21,"ion-icon",14),t.k0s()()()()}2&n&&(t.R7$(6),t.Y8G("scrollEvents",!0)("fullscreen",!0),t.R7$(6),t.Y8G("ngForOf",s.messages),t.R7$(),t.Y8G("ngIf",1==s.spinner),t.R7$(5),t.R50("ngModel",s.userInput))},dependencies:[d.YU,d.Sq,d.bT,u.BC,u.vS,i.Jm,i.QW,i.hU,i.W9,i.M0,i.eU,i.iq,i.$w,i.uz,i.MC,i.ln,i.w2,i.BC,i.ai,i.Gw],styles:[".roundedInput[_ngcontent-%COMP%]{--border-color: gray;--border-radius: 5px;--border-width: 2px;--box-shadow: 2px gray;--highlight-height: 0;--background: #ffffff;padding:2%;height:50px}ion-boutton[_ngcontent-%COMP%]{text-transform:capitalize}.chat-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:10px}.user[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]{background-color:#d7d7d7;align-self:flex-end;border-radius:15px;padding:10px;margin:5px 0;max-width:70%;white-space:pre-line}.ai[_ngcontent-%COMP%]   .message-bubble[_ngcontent-%COMP%]{background-color:#fff;color:#000;align-self:flex-start;border-radius:15px;padding:10px;font-weight:700;line-height:1;margin:5px 0;max-width:70%;white-space:pre-line}ion-content[_ngcontent-%COMP%]{background-color:#fff!important}"]})}}return o})()}];let T=(()=>{class o{static{this.\u0275fac=function(n){return new(n||o)}}static{this.\u0275mod=t.$C({type:o})}static{this.\u0275inj=t.G2t({imports:[p.iI.forChild(S),p.iI]})}}return o})();var P=a(4842);let x=(()=>{class o{static{this.\u0275fac=function(n){return new(n||o)}}static{this.\u0275mod=t.$C({type:o})}static{this.\u0275inj=t.G2t({imports:[d.MD,u.YN,i.bv,T,P.h]})}}return o})()}}]);